!function(a,b){var c="bootstrapCalendar";if(typeof define==="function"&&define.amd){define(["jquery","moment","underscore"],function(e,f,d){a[c]=b(c,a,e,f,d)})}else{a[c]=b(c,a,(a.jQuery||a.$),a.moment,a._)}}(this,function(f,a,e,h,c){String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var g={date:"now",view:"month",locale:"en",events:false,classes:{header:".calendar-header",headerTitle:".calendar-title",container:".calendar-container"},templates_path:"templates/"},b={initialize:function(j){j.setLocale(j.options.locale);j.render(j.options.date);j.$wrapper.on("click.bs.calendar","*[data-calendar-view]",function(l){l.preventDefault();var k=e(this);j.navigate("view",k.data("calendar-view"),k.data("calendar-date"))}).on("click.bs.calendar","*[data-calendar-goto]",function(l){l.preventDefault();var k=e(this);j.navigate("goto",k.data("calendar-goto"),k.data("calendar-date"))})},loadTemplate:function(j,k){if(j.constants.templates[k]){return}else{e.ajax({url:j.options.templates_path+k+".html",dataType:"html",type:"GET",async:false}).done(function(l){j.constants.templates[k]=c.template(l)})}},selectEvents:function(k,m,j){var l=[];e.each(k,function(n,o){if((m<=o.start&&j>o.start)||(m<=o.end&&j>o.end)||(m>o.start&&j<=o.end)){l.push(o)}});return l}},d=function(k,j){this._defaults=g;this._name=f;this.element=k;this.options=j;this.constants={views:["year","month","week"],templates:{},months:[],weekdays:[],weekdaysShort:[],weekdaysMin:[],position:{date:null,start:null,end:null},data:{events:[]}};this.$wrapper=e(this.element);this.$header=this.$wrapper.find(this.options.classes.header).first();this.$headerTitle=this.$header.find(this.options.classes.headerTitle).first();this.$container=this.$wrapper.find(this.options.classes.container).first();b.initialize(this)};d.prototype={constructor:d,setLocale:function(j){j=typeof j==="string"?j:this.options.locale,localeData=h.localeData(),weekday=h();h.locale(this.options.locale=j);this.constants.months=h.months();this.constants.weekdays=[];this.constants.weekdaysShort=[];this.constants.weekdaysMin=[];for(i=0;i<7;i++){weekday.weekday(i);this.constants.weekdays.push(localeData.weekdays(weekday));this.constants.weekdaysShort.push(localeData.weekdaysShort(weekday));this.constants.weekdaysMin.push(localeData.weekdaysMin(weekday))}return this},navigate:function(k,l,j){this.$wrapper.trigger("beforeNavigate.bs.calendar",[this]);switch(k){case"view":if(e.inArray(l,this.constants.views)!==-1){j=typeof j==="string"?h(j):this.constants.position.date;this.options.view=l}else{e.error(f+": invalid view: "+l)}break;case"goto":if(e.inArray(l,["prev","next","today"])!==-1){if(l==="today"){j=h()}else{if(l==="prev"&&this.options.view==="year"){j=h(this.constants.position.start).subtract(1,"year")}else{if(l==="prev"&&this.options.view==="month"){j=h(this.constants.position.start).subtract(1,"months")}else{if(l==="prev"&&this.options.view==="week"){j=h(this.constants.position.start).subtract(7,"days")}else{if(l==="next"&&this.options.view==="year"){j=h(this.constants.position.start).add(1,"year")}else{if(l==="next"&&this.options.view==="month"){j=h(this.constants.position.start).add(1,"months")}else{if(l==="next"&&this.options.view==="week"){j=h(this.constants.position.start).add(7,"days")}}}}}}}}else{e.error(f+": invalid goto: "+l)}break;default:e.error(f+": invalid type: "+k)}this.$wrapper.trigger("afterNavigate.bs.calendar",[this]);this.render(j.format("YYYY-MM-DD"))},render:function(o){this.$wrapper.trigger("beforeRender.bs.calendar",[this]);var j=this,m={instance:j,now:h(),position:{date:null,start:null,end:null},events:[]},p,l,n,k;o=typeof o==="string"?o:j.constants.position.date.format("YYYY-MM-DD");if(o==="now"){m.position.date=h()}else{if(o.match(/^\d{4}-\d{2}-\d{2}$/g)){m.position.date=h(o,"YYYY-MM-DD")}else{e.error(f+": invalid format: "+o)}}l=m.position.date.year();n=m.position.date.month();k=m.position.date.date();switch(j.options.view){case"year":m.position.start=h(new Date(l,0,1));m.position.end=h(m.position.start).add(1,"years");m.counter=h(m.position.start);m.end=h(m.position.end);p=m.position.date.format("YYYY");break;case"month":m.position.start=h(new Date(l,n,1));m.position.end=h(m.position.start).add(1,"months");m.counter=h(m.position.start).weekday(0);m.end=m.position.end.weekday()===0?h(m.position.end):h(m.position.end).weekday(7);p=m.position.date.format("MMMM YYYY");break;case"week":m.week=h(new Date(l,n,k)).week();m.position.start=h(new Date(l,n,k)).week(m.week).weekday(0);m.position.end=h(new Date(l,n,k)).week(m.week).weekday(7);m.counter=h(m.position.start);m.end=h(m.position.end);p=h(m.position.end).subtract(1,"milliseconds").format("YYYY | % w").replace("%","wk");break;default:e.error(f+": invalid view: "+j.options.view)}j.constants.position=m.position;j.constants.data.events=j.options.events;if(typeof j.constants.data.events==="object"){m.events=b.selectEvents(j.constants.data.events,m.counter.format("YYYY-MM-DD HH:mm:ss"),m.end.format("YYYY-MM-DD HH:mm:ss"))}j.$container.empty();j.$headerTitle.html(p.ucfirst());b.loadTemplate(j,j.options.view);e.when(j.$container.html(j.constants.templates[j.options.view](m))).then(function(){j.$wrapper.trigger("afterRender.bs.calendar",[j]);j.$wrapper.trigger("renderEvents.bs.calendar",[m.events])})},renderSection:function(k){var j,l={start:h(k),end:h(k),events:false};switch(this.options.view){case"year":j="year-month";l.end.add(1,"months");break;case"month":j="month-day";l.end.add(1,"days");break;case"week":j="week-day";l.end.add(1,"days");break;default:e.error(f+": invalid view: "+this.options.view)}b.loadTemplate(this,j);if(typeof this.constants.data.events==="object"){l.events=b.selectEvents(this.constants.data.events,l.start.format("YYYY-MM-DD HH:mm:ss"),l.end.format("YYYY-MM-DD HH:mm:ss"))}return this.constants.templates[j](l)}};e.fn[f]=function(j){j=e.extend(true,{},g,j);return this.each(function(){var k=e(this);k.data(f,new d(k,j))})};e.fn[f].defaults=g;e.fn[f].Plugin=d});